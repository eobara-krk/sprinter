<main>
  <div class="placeholder">

    <!-- HEADER Z LOGO, DATƒÑ I AUDIO -->
    <div class="header">
      <!-- Uk≈Çad dwukolumnowy: Lewa (logo+tytu≈Ç) | Prawa (data+audio) -->
      <div class="header-top-line">
        <!-- LEWA STRONA: Logo + Tytu≈Ç g≈Ç√≥wny -->
        <div class="left-column">
          <div class="logo-section">
            <img src="assets/sprint.png" alt="Sprint" 
                 (load)="onImageLoad($event)" 
                 (error)="onImageError($event)"
                 loading="lazy" />
          </div>
          <div class="header-title">
              <h1>Podsumowania sprint√≥w <br>2025 r.</h1>
          </div>
        </div>
  <!-- Usuniƒôto nadmiarowy zamykajƒÖcy tag div po zakomentowanej sekcji left-column -->
        
        <!-- PRAWA STRONA: Data + Audio -->
        <div class="right-column">
          <div style="width: 140px; display: flex; flex-direction: column; align-items: center;">
            <img src="assets/Logo_KRUK_cmyk2.png" alt="Logo"
              class="logo-section-img"
              style="max-width: 110px; max-height: 110px; width: auto; height: auto; background: transparent; margin-bottom: 8px; display: block;"
              (load)="onImageLoad($event)"
              (error)="onImageError($event)"
              loading="lazy" />
          
            <div class="date-line" style="text-align: center; width: 100%;">
              <br>
              <h2 style="font-size:1.1em; margin:0;">{{ currentDateTime | date:'EEEE dd.MM.yyyy':'':'pl-PL' }} r.</h2>
            </div>
          </div>
       
        </div>
      </div>
    </div>

  <hr class="custom-divider">
    <div class="divider"></div>

    <!-- EVENTY -->
  <div *ngFor="let item of items; let i = index, trackBy: trackByTitle" class="event-card" [attr.id]="'folder-' + i">

  <!-- Nag≈Ç√≥wek wydarzenia g√≥wny folder z pineskƒÖ-->
  <div class="event-header" (click)="toggle(item)">
  <span>üìå <span class="event-title" [innerHTML]="item.title"></span></span>
  <span>{{ item.show ? '‚ñ≤' : '‚ñº' }}</span>
      </div>

      <!-- Zawarto≈õƒá wydarzenia -->
      <div class="pill-group" *ngIf="item.show">

        <!-- Miniatura obrazka wydarzenia -->
        <div class="event-image-container" *ngIf="item.image">
          <img [src]="item.image"
               alt="Obraz wydarzenia"
               class="event-thumb"
               (click)="toggleFullscreen(item.image); $event.stopPropagation();" />

        </div>

        <!-- GRUPY LINK√ìW I OPISY -->
        <div class="groups-container">
          <ng-container *ngFor="let group of item.links; trackBy: trackByName">
              <!-- Miniaturka grupy -->
              <div class="event-image-container" *ngIf="group.image">
                <img [src]="group.image"
                     alt="Obraz grupy"
                     class="event-thumb"
                     (click)="toggleFullscreen(group.image); $event.stopPropagation();" />
              </div>

              <!-- FOLDER NA ZA≈ÅƒÑCZNIKI (zawsze, je≈õli sƒÖ linki) -->
              <div *ngIf="group.links && group.links.length > 0" class="group-container">
                <div class="grid-link main-link" (click)="toggleOnlyNestedGroup(group, item.links || [])">
                  <span class="expand-icon">‚ñ∂</span>
                  <span *ngIf="group.name !== 'PrzeglƒÖd kodu'">üìÅ</span>
                  <span *ngIf="group.name === 'PrzeglƒÖd kodu'">üñºÔ∏è</span>
                  <span class="zadanie-label">{{ group.name }}</span>
                  <span>{{ group.show ? '‚ñ≤' : '‚ñº' }}</span>
                </div>
                <div class="sub-links-container" *ngIf="group.show">
                  <ng-container *ngFor="let link of group.links">
                    <!-- Rekurencyjny podfolder: je≈õli link ma links (czyli jest podfolderem) -->
                    <div *ngIf="link.links && link.links.length > 0" class="group-container nested-group">
                      <div class="grid-link main-link" (click)="toggleOnlyNestedGroup(link, group.links)">
                        <span class="expand-icon">‚ñ∂</span>
                        <span *ngIf="link.name !== 'PrzeglƒÖd kodu'">üìÅ</span>
                        <span *ngIf="link.name === 'PrzeglƒÖd kodu'">üñºÔ∏è</span>
                        <span class="zadanie-label">{{ link.name }}</span>
                        <span>{{ link.show ? '‚ñ≤' : '‚ñº' }}</span>
                      </div>
                      <div class="sub-links-container" *ngIf="link.show">
                        <!-- Rekurencja: wywo≈Çaj ten sam blok dla podfolderu -->
                        <ng-container *ngFor="let sublink of link.links">
                          <!-- Rekurencja: podfoldery ni≈ºszego poziomu -->
                          <div *ngIf="sublink.links && sublink.links.length > 0" class="group-container nested-group">
                            <div class="grid-link main-link" (click)="toggleOnlyNestedGroup(sublink, link.links)">
                              <span class="expand-icon">‚ñ∂</span>
                              <span *ngIf="sublink.name !== 'PrzeglƒÖd kodu'">üìÅ</span>
                              <span *ngIf="sublink.name === 'PrzeglƒÖd kodu'">üñºÔ∏è</span>
                              <span class="zadanie-label">{{ sublink.name }}</span>
                              <span>{{ sublink.show ? '‚ñ≤' : '‚ñº' }}</span>
                            </div>
                            <div class="sub-links-container" *ngIf="sublink.show">
                              <ng-container *ngFor="let subsub of sublink.links">
                                <!-- PDF -->
                                <a *ngIf="subsub.type==='pdf' && subsub.url" 
                                   class="grid-link sub-link pdf-item"
                                   [href]="subsub.url"
                                   target="_blank"
                                   rel="noopener">
                                  <span class="pdf-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                      <rect x="3" y="3" width="18" height="18" rx="4" fill="#d32f2f"/>
                                      <text x="6" y="17" font-size="10" font-family="Arial, sans-serif" fill="#fff" font-weight="bold">PDF</text>
                                    </svg>
                                  </span>
                                  <span [innerHTML]="subsub.label || subsub.url"></span>
                                </a>
                                <!-- FOTO -->
                                <div *ngIf="subsub.type==='foto'" class="grid-link sub-link foto-item">
                                  <div class="link-thumb-container">
                                    <img [src]="subsub.image" 
                                         alt="Miniaturka" 
                                         class="link-thumb"
                                         loading="lazy"
                                         decoding="async"
                                         (load)="onImageLoad($event)"
                                         (error)="onImageError($event)"
                                         (click)="toggleFullscreen(subsub.image); $event.preventDefault(); $event.stopPropagation();" />
                                    <span class="link-label" *ngIf="subsub.label" [innerHTML]="subsub.label"></span>
                                  </div>
                                </div>
                                <!-- OPIS W PODLINKU -->
                                <div *ngIf="subsub.type==='opis' && subsub.text" class="grid-link sub-link text-item" style="position:relative;">
                                  <div *ngIf="!subsub.show" class="text-collapsed-header" (click)="textVisibilityService.toggleTextVisibility(subsub); $event.stopPropagation();">
                                    <div class="text-collapsed-left">
                                      <span class="text-icon">üìù</span>
                                      <div class="text-toggle-label" [innerHTML]="subsub.label || 'Opis' "></div>
                                    </div>
                                    <span class="text-toggle-icon">‚ñº</span>
                                  </div>
                                </div>
                              </ng-container>
                            </div>
                          </div>
                          <!-- Standardowe linki (nie sƒÖ podfolderem) -->
                          <ng-container *ngIf="!sublink.links || sublink.links.length === 0">
                            <!-- PDF -->
                            <a *ngIf="sublink.type==='pdf' && sublink.url" 
                               class="grid-link sub-link pdf-item"
                               [href]="sublink.url"
                               target="_blank"
                               rel="noopener">
                              <span class="pdf-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <rect x="3" y="3" width="18" height="18" rx="4" fill="#d32f2f"/>
                                  <text x="6" y="17" font-size="10" font-family="Arial, sans-serif" fill="#fff" font-weight="bold">PDF</text>
                                </svg>
                              </span>
                              <span [innerHTML]="sublink.label || sublink.url"></span>
                            </a>
                            <!-- FOTO -->
                            <div *ngIf="sublink.type==='foto'" class="grid-link sub-link foto-item">
                              <div class="link-thumb-container">
                                <img [src]="sublink.image" 
                                     alt="Miniaturka" 
                                     class="link-thumb"
                                     loading="lazy"
                                     decoding="async"
                                     (load)="onImageLoad($event)"
                                     (error)="onImageError($event)"
                                     (click)="toggleFullscreen(sublink.image); $event.preventDefault(); $event.stopPropagation();" />
                                <span class="link-label" *ngIf="sublink.label" [innerHTML]="sublink.label"></span>
                              </div>
                            </div>
                            <!-- OPIS W PODLINKU -->
                            <div *ngIf="sublink.type==='opis' && sublink.text" class="grid-link sub-link text-item" style="position:relative;">
                              <div *ngIf="!sublink.show" class="text-collapsed-header" (click)="textVisibilityService.toggleTextVisibility(sublink); $event.stopPropagation();">
                                <div class="text-collapsed-left">
                                  <span class="text-icon">üìù</span>
                                  <div class="text-toggle-label" [innerHTML]="sublink.label || 'Opis' "></div>
                                </div>
                                <span class="text-toggle-icon">‚ñº</span>
                              </div>
                            </div>
                          </ng-container>
                        </ng-container>
                      </div>
                    </div>
                    <!-- Standardowe linki (nie sƒÖ podfolderem) -->
                    <ng-container *ngIf="!link.links || link.links.length === 0">
                      <!-- PDF -->
                      <a *ngIf="link.type==='pdf' && link.url" 
                         class="grid-link sub-link pdf-item"
                         [href]="link.url"
                         target="_blank"
                         rel="noopener">
                        <span class="pdf-icon">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="3" y="3" width="18" height="18" rx="4" fill="#d32f2f"/>
                            <text x="6" y="17" font-size="10" font-family="Arial, sans-serif" fill="#fff" font-weight="bold">PDF</text>
                          </svg>
                        </span>
                        <span [innerHTML]="link.label || link.url"></span>
                      </a>
                      <!-- FOTO -->
                      <div *ngIf="link.type==='foto'" class="grid-link sub-link foto-item">
                        <div class="link-thumb-container">
                          <img [src]="link.image" 
                               alt="Miniaturka" 
                               class="link-thumb"
                               loading="lazy"
                               decoding="async"
                               (load)="onImageLoad($event)"
                               (error)="onImageError($event)"
                               (click)="toggleFullscreen(link.image); $event.preventDefault(); $event.stopPropagation();" />
                          <span class="link-label" *ngIf="link.label" [innerHTML]="link.label"></span>
                        </div>
                      </div>
                      <!-- OPIS W PODLINKU -->
                      <div *ngIf="link.type==='opis' && link.text" class="grid-link sub-link text-item" style="position:relative;">
                        <div *ngIf="!link.show" class="text-collapsed-header" (click)="textVisibilityService.toggleTextVisibility(link); $event.stopPropagation();">
                          <div class="text-collapsed-left">
                            <span class="text-icon">üìù</span>
                            <div class="text-toggle-label" [innerHTML]="link.label || 'Opis' "></div>
                          </div>
                          <span class="text-toggle-icon">‚ñº</span>
                        </div>
                      </div>
                    </ng-container>
                  </ng-container>
                </div>
              </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>

    <!-- STOPKA w kontenerku -->
    <div class="footer-section">
      <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
        <div style="font-size: 0.95em; color: #666;">Przydatne linki:  <a href="https://krukeu.sharepoint.com/sites/ITINTHQPL/SitePages/bibliotekaszablonow.aspx" target="_blank" rel="noopener">bibliotek szablon√≥w</a></div>
        <div class="znak-wodny">
          ¬© <span class="ozdobne">EO</span>
        </div>
      </div>
      <button class="close-button" (click)="closePage()">
        <span class="close-icon">√ó</span>
        <span class="close-text">Zamknij stronƒô</span>
      </button>
    </div>


<!-- FULLSCREEN IMAGE - overlay poza main -->
<div id="fullscreen-overlay" class="fullscreen-local" *ngIf="fullscreenImage" (click)="toggleFullscreen()">
  <img [src]="fullscreenImage" 
       class="fullscreen-local-image"
       loading="eager"
       decoding="async" />
</div>

<!-- FULLSCREEN TEXT - overlay poza main -->
<div *ngFor="let item of items" style="display:contents">
  <ng-container *ngFor="let group of item.links">
    <ng-container *ngFor="let l of group.links">
      <div class="text-fullscreen-overlay" *ngIf="l.type==='opis' && l.text && l.show" (click)="textVisibilityService.toggleTextVisibility(l)">
        <div class="text-fullscreen-content" (click)="textVisibilityService.toggleTextVisibility(l)">
          <button (click)="textVisibilityService.toggleTextVisibility(l)" class="close-text-btn" title="Zamknij tekst" style="position:absolute; top:12px; right:12px; background:#2563eb; border:none; font-size:1.3em; cursor:pointer; color:#fff; z-index:10; border-radius:50%; width:32px; height:32px; display:flex; align-items:center; justify-content:center; box-shadow:0 2px 8px rgba(59,130,246,0.18);">‚úñ</button>
          <div class="sub-text" style="font-size:1.3em; font-weight:600; margin-bottom:1em; color:#2563eb;">{{ l.label }}</div>
          <div class="sub-text" [innerHTML]="textFormatService.processTextWithLinks(l.text)"></div>
        </div>
      </div>
    </ng-container>
  </ng-container>
</div>

<!-- FULLSCREEN PHOTO ALBUM - overlay poza main -->
<div *ngFor="let item of items" style="display:contents">
  <ng-container *ngFor="let group of item.links">
    <ng-container *ngFor="let l of group.links">
      <div *ngIf="l.name === 'PrzeglƒÖd kodu' && l.show && hasPhotoElements(l.links || []) && getPhotoCount(l.links || []) > 1" class="fullscreen-local" (click)="toggleOnlyNestedGroup(l, group.links || [])">
        <div (click)="$event.stopPropagation()">
          <photo-gallery [photos]="getPhotoElements(l.links || [])" [groupName]="l.name || ''"></photo-gallery>
        </div>
      </div>
    </ng-container>
  </ng-container>
</div>
