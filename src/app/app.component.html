<main>
  <div class="placeholder">

    <!-- HEADER Z LOGO, DATÄ„ I AUDIO -->
    <div class="header">
      <!-- UkÅ‚ad dwukolumnowy: Lewa (logo+tytuÅ‚) | Prawa (data+audio) -->
      <div class="header-top-line">
        <!-- LEWA STRONA: Logo + TytuÅ‚ gÅ‚Ã³wny -->
        <div class="left-column">
          <div class="logo-section">
            <img src="assets/sprint.png" alt="Sprint" 
                 (load)="onImageLoad($event)" 
                 (error)="onImageError($event)"
                 loading="lazy" />
          </div>
          <div class="header-title">
              <h1>Podsumowania sprintÃ³w <br>2025 r.</h1>
          </div>
        </div>
  <!-- UsuniÄ™to nadmiarowy zamykajÄ…cy tag div po zakomentowanej sekcji left-column -->
        
        <!-- PRAWA STRONA: Data + Audio -->
        <div class="right-column">
          <div style="width: 140px; display: flex; flex-direction: column; align-items: center;">
            <img src="assets/Logo_KRUK_cmyk.png" alt="Logo"
              class="logo-section-img"
              style="max-width: 110px; max-height: 110px; width: auto; height: auto; background: transparent; margin-bottom: 8px; display: block;"
              (load)="onImageLoad($event)"
              (error)="onImageError($event)"
              loading="lazy" />
          
            <div class="date-line" style="text-align: center; width: 100%;">
              <br>
              <h2 style="font-size:1.1em; margin:0;">{{ currentDateTime | date:'EEEE dd.MM.yyyy':'':'pl-PL' }} r.</h2>
            </div>
          </div>
          
          <div class="audio-section" style="display: flex; flex-direction: column; align-items: flex-end; width: 100%;">
            <!-- Audio controls mogÄ… byÄ‡ tu dodane, jeÅ›li bÄ™dÄ… potrzebne -->
          </div>
        </div>
      </div>
    </div>

  <hr class="custom-divider">
    <div class="divider"></div>

    <!-- EVENTY -->
  <div *ngFor="let item of items; let i = index, trackBy: trackByTitle" class="event-card" [attr.id]="'folder-' + i">

      <!-- NagÅ‚Ã³wek wydarzenia -->
      <div class="event-header" (click)="toggle(item)">
  <span *ngIf="isTodayInTitleRange(item.title) || hasInnerTodayGroups(item)">ğŸ‘‰</span>
  <span>ğŸ“Œ <span class="event-title" [innerHTML]="item.title"></span></span>
  <span>{{ item.show ? 'â–²' : 'â–¼' }}</span>
      </div>

      <!-- ZawartoÅ›Ä‡ wydarzenia -->
      <div class="pill-group" *ngIf="item.show">

        <!-- Miniatura obrazka wydarzenia -->
        <div class="event-image-container" *ngIf="item.image">
          <img [src]="item.image"
               alt="Obraz wydarzenia"
               class="event-thumb"
               (click)="toggleFullscreen(item.image); $event.stopPropagation();" />

        </div>

        <!-- GRUPY LINKÃ“W I OPISY -->
        <div class="groups-container">
          <ng-container *ngFor="let group of item.links; trackBy: trackByName">


            <!-- Miniaturka grupy -->
            <div class="event-image-container" *ngIf="group.image">
              <img [src]="group.image"
                   alt="Obraz grupy"
                   class="event-thumb"
                   (click)="toggleFullscreen(group.image); $event.stopPropagation();" />
            </div>

            <!-- OPIS -->
            <div *ngIf="group.type==='opis'" class="grid-link description-link" (click)="openOnly(group, item)">
              <span *ngIf="(group.name && isToday(group.name)) || hasInnerTodayElements(group)">ğŸ‘‰</span>
              <span *ngIf="group.protected">ğŸ”’</span>
              <span *ngIf="!group.protected">ğŸ“</span>
              {{ group.name }}

              <div *ngIf="group.show && group.text" class="event-description">
                <div class="justified-text" [innerHTML]="textFormatService.processTextWithLinks(group.text)"></div>
              </div>
            </div>

              <!-- WyÅ›wietl nazwÄ™ grupy, jeÅ›li nie ma opisu ani linkÃ³w, ale jest podgrupa 'PrzeglÄ…d kodu' -->
              <div *ngIf="!group.type && group.links && group.links.length === 1 && (group.links[0].name === 'PrzeglÄ…d kodu' || group.links[0].name === 'zalacznik')" class="group-container">
                <div class="grid-link main-link" (click)="group.links[0].show = !group.links[0].show; $event.stopPropagation();">
                  <span class="expand-icon">{{ group.links[0].show ? 'â–¼' : 'â–¶' }}</span>
                  <span *ngIf="group.links[0].name && group.links[0].name.toLowerCase().includes('przeglÄ…d')" style="color:#2563eb;font-size:1.3em">ğŸ’»</span>
                  <!-- folder tylko dla zalacznik -->
                  <ng-container *ngIf="group.links[0].name === 'zalacznik'">
                    <span class="folder-icon" style="color:gold">ğŸ“</span>
                  </ng-container>
                  <span class="zadanie-label">{{ group.name }}</span>
                </div>
                <!-- Album zdjÄ™Ä‡ w podgrupie lub PDF-y w zalacznik -->
                <div *ngIf="group.links[0].show" class="sub-links-container">
                  <photo-gallery *ngIf="group.links[0].name === 'PrzeglÄ…d kodu' && hasPhotoElements(group.links[0].links || []) && getPhotoCount(group.links[0].links || []) > 1"
                    [photos]="getPhotoElements(group.links[0].links || [])"
                    [groupName]="group.links[0].name || ''">
                  </photo-gallery>
                  <ng-container *ngIf="group.links[0].name === 'zalacznik'">
                    <div class="pdf-list">
                      <a *ngFor="let pdf of group.links[0].links" class="grid-link sub-link pdf-item" [href]="pdf.url" target="_blank" rel="noopener">
                        <span class="pdf-icon">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="3" y="3" width="18" height="18" rx="4" fill="#d32f2f"/>
                            <text x="6" y="17" font-size="10" font-family="Arial, sans-serif" fill="#fff" font-weight="bold">PDF</text>
                          </svg>
                        </span>
                        <span [innerHTML]="pdf.label || pdf.url"></span>
                      </a>
                    </div>
                  </ng-container>
                </div>
              </div>

            <!-- GRUPA Z WIELOMA LINKAMI (nie jest opisem i ma wiÄ™cej niÅ¼ 1 link) -->
            <div *ngIf="group.type !== 'opis' && group.links && group.links.length > 1" 
                 class="group-container"
                 [class.expanded]="group.show"
                 [class.today-highlight]="group.name ? isToday(group.name) : false"
                 (click)="openOnly(group, item); $event.stopPropagation()">
                 
              <!-- GÅ‚Ã³wny link grupy -->
              <div class="grid-link main-link"
                   [class.today-highlight]="group.name ? isToday(group.name) : false">
                <span *ngIf="(group.name && isToday(group.name)) || hasInnerTodayElements(group)">ğŸ‘‰</span>
                <span class="expand-icon">{{ group.show ? 'â–¼' : 'â–¶' }}</span>
                <span>ğŸ“</span>
                <span class="zadanie-label">{{ group.name }}</span>
              </div>

              <!-- PODLINKI (grupy z wieloma linkami) -->
              <ng-container *ngIf="group.show && group.links as links">
                <div *ngIf="links.length > 1" class="sub-links-container">
                  <div class="connection-line"></div>
                  <div class="link-grid" [class.photo-grid]="hasPhotoElements(links)">
                <ng-container *ngFor="let l of links">
                  
                  <!-- JeÅ›li link ma zagnieÅ¼dÅ¼one linki -->
                  <ng-container *ngIf="l.links && l.links.length > 0">
                    <div class="nested-group">
                      <div class="nested-header" (click)="toggleOnlyNestedGroup(l, links); $event.stopPropagation()">
                        <span class="nested-icon">{{ l.show ? 'â–¼' : 'â–¶' }}</span>
                        <span class="folder-icon" style="color:gold">ğŸ“</span>
                        <ng-container *ngIf="l.name !== 'PrzeglÄ…d kodu'; else kodIcon"></ng-container>
                        <ng-template #kodIcon><span style="color:#2563eb;font-size:1.3em">ğŸ’»</span> PrzeglÄ…d kodu</ng-template>
                      </div>
                      <!-- ZagnieÅ¼dÅ¼one linki -->
                      <div *ngIf="l.show" class="nested-links">
                        <photo-gallery *ngIf="hasPhotoElements(l.links) && getPhotoCount(l.links) > 1"
                          [photos]="getPhotoElements(l.links)"
                          [groupName]="l.name || ''">
                        </photo-gallery>
                        <ng-container *ngFor="let nestedLink of l.links">
                          <ng-container *ngIf="nestedLink.links && nestedLink.links.length > 0; else leafLink">
                            <div class="nested-group">
                              <div class="nested-header" (click)="toggleOnlyNestedGroup(nestedLink, l.links); $event.stopPropagation()">
                                <span class="nested-icon">{{ nestedLink.show ? 'â–¼' : 'â–¶' }}</span>
                                <span class="folder-icon" style="color:gold">ğŸ“</span>
                                <ng-container *ngIf="nestedLink.name !== 'PrzeglÄ…d kodu'; else kodIcon2"></ng-container>
                                <ng-template #kodIcon2><span style="color:#2563eb;font-size:1.3em">ğŸ’»</span> PrzeglÄ…d kodu</ng-template>
                              </div>
                              <div *ngIf="nestedLink.show" class="nested-links">
                                <photo-gallery *ngIf="hasPhotoElements(nestedLink.links) && getPhotoCount(nestedLink.links) > 1"
                                  [photos]="getPhotoElements(nestedLink.links)"
                                  [groupName]="nestedLink.name || ''">
                                </photo-gallery>
                                <ng-container *ngFor="let deepLink of nestedLink.links">
                                  <ng-container *ngIf="deepLink.links && deepLink.links.length > 0; else deepLeaf">
                                    <div class="nested-group">
                                      <div class="nested-header" (click)="toggleOnlyNestedGroup(deepLink, nestedLink.links); $event.stopPropagation()">
                                        <span class="nested-icon">{{ deepLink.show ? 'â–¼' : 'â–¶' }}</span>
                                        <span class="folder-icon" style="color:gold">ğŸ“</span>
                                        <ng-container *ngIf="deepLink.name !== 'PrzeglÄ…d kodu'; else kodIcon3"></ng-container>
                                        <ng-template #kodIcon3><span style="color:#2563eb;font-size:1.3em">ğŸ’»</span> PrzeglÄ…d kodu</ng-template>
                                      </div>
                                      <div *ngIf="deepLink.show" class="nested-links">
                                        <photo-gallery *ngIf="hasPhotoElements(deepLink.links) && getPhotoCount(deepLink.links) > 1"
                                          [photos]="getPhotoElements(deepLink.links)"
                                          [groupName]="deepLink.name || ''">
                                        </photo-gallery>
                                        <ng-container *ngFor="let leaf of deepLink.links">
                                          <ng-container *ngIf="leaf.links && leaf.links.length > 0; else leafLeaf">
                                            <!-- Jeszcze gÅ‚Ä™biej: kolejne poziomy -->
                                          </ng-container>
                                          <ng-template #leafLeaf>
                                            <a class="grid-link nested-link"
                                               [class.today-highlight]="(leaf.label || leaf.url) ? isToday(leaf.label || leaf.url || '') : false"
                                               [href]="leaf.url || null"
                                               target="_blank"
                                               rel="noopener"
                                               (click)="$event.stopPropagation()">
                                              <span *ngIf="(leaf.label || leaf.url) && isToday(leaf.label || leaf.url || '')">ğŸ‘‰</span>
                                              <span class="sub-icon">â¤â¤</span>
                                              <span [ngSwitch]="leaf.type">
                                                <span *ngSwitchCase="'film'">ğŸ¬</span>
                                                <span *ngSwitchCase="'pdf'">ğŸ“•</span>
                                                <span *ngSwitchCase="'exec'">ğŸ’¿</span>
                                                <span *ngSwitchCase="'foto'">ğŸ“·</span>
                                                <span *ngSwitchCase="'audio'">ğŸµ</span>
                                                <span *ngSwitchCase="'youtube'">ğŸ“º</span>
                                                <span *ngSwitchCase="'html'">ğŸŒ</span>
                                                <span *ngSwitchDefault>ğŸ“</span>
                                              </span>
                                              {{ leaf.label || leaf.url }}
                                            </a>
                                          </ng-template>
                                        </ng-container>
                                      </div>
                                    </div>
                                  </ng-container>
                                  <ng-template #deepLeaf>
                                    <a class="grid-link nested-link"
                                       [class.today-highlight]="(deepLink.label || deepLink.url) ? isToday(deepLink.label || deepLink.url || '') : false"
                                       [href]="deepLink.url || null"
                                       target="_blank"
                                       rel="noopener"
                                       (click)="$event.stopPropagation()">
                                      <span *ngIf="(deepLink.label || deepLink.url) && isToday(deepLink.label || deepLink.url || '')">ğŸ‘‰</span>
                                      <span class="sub-icon">â¤â¤</span>
                                      <span [ngSwitch]="deepLink.type">
                                        <span *ngSwitchCase="'film'">ğŸ¬</span>
                                        <span *ngSwitchCase="'pdf'">ğŸ“•</span>
                                        <span *ngSwitchCase="'exec'">ğŸ’¿</span>
                                        <span *ngSwitchCase="'foto'">ğŸ“·</span>
                                        <span *ngSwitchCase="'audio'">ğŸµ</span>
                                        <span *ngSwitchCase="'youtube'">ğŸ“º</span>
                                        <span *ngSwitchCase="'html'">ğŸŒ</span>
                                        <span *ngSwitchDefault>ğŸ“</span>
                                      </span>
                                      {{ deepLink.label || deepLink.url }}
                                    </a>
                                  </ng-template>
                                </ng-container>
                              </div>
                            </div>
                          </ng-container>
                          <ng-template #leafLink>
                            <a class="grid-link nested-link"
                               [class.today-highlight]="(nestedLink.label || nestedLink.url) ? isToday(nestedLink.label || nestedLink.url || '') : false"
                               [href]="nestedLink.url || null"
                               target="_blank"
                               rel="noopener"
                               (click)="$event.stopPropagation()">
                              <span *ngIf="(nestedLink.label || nestedLink.url) && isToday(nestedLink.label || nestedLink.url || '')">ğŸ‘‰</span>
                              <span class="sub-icon">â¤â¤</span>
                              <span [ngSwitch]="nestedLink.type">
                                <span *ngSwitchCase="'film'">ğŸ¬</span>
                                <span *ngSwitchCase="'pdf'">ğŸ“•</span>
                                <span *ngSwitchCase="'exec'">ğŸ’¿</span>
                                <span *ngSwitchCase="'foto'">ğŸ“·</span>
                                <span *ngSwitchCase="'audio'">ğŸµ</span>
                                <span *ngSwitchCase="'youtube'">ğŸ“º</span>
                                <span *ngSwitchCase="'html'">ğŸŒ</span>
                                <span *ngSwitchDefault>ğŸ“</span>
                              </span>
                              {{ nestedLink.label || nestedLink.url }}
                            </a>
                          </ng-template>
                        </ng-container>
                      </div>
                    </div>
                  </ng-container>

                  <!-- ZwykÅ‚y link (bez zagnieÅ¼dÅ¼onych linkÃ³w) -->
                  <ng-container *ngIf="!l.links || l.links.length === 0">
                    <!-- Element foto (tylko zdjÄ™cie) -->
                    <div *ngIf="l.type==='foto'" 
                         class="grid-link sub-link foto-item"
                         [class.today-highlight]="(l.label || l.url) ? isToday(l.label || l.url || '') : false">
                      <div class="link-thumb-container">
                        <img [src]="l.image" 
                             alt="Miniaturka" 
                             class="link-thumb"
                             loading="lazy"
                             decoding="async"
                             (load)="onImageLoad($event)"
                             (error)="onImageError($event)"
                             (click)="toggleFullscreen(l.image); $event.preventDefault(); $event.stopPropagation();" />
                        <span class="link-label" *ngIf="l.label" [innerHTML]="l.label"></span>
                      </div>
                      <span *ngIf="(l.label || l.url) && isToday(l.label || l.url || '')">ğŸ‘‰</span>
                    </div>

                    <!-- Element PDF z ikonÄ… -->
                    <a *ngIf="l.type==='pdf' && l.url" 
                       class="grid-link sub-link pdf-item"
                       [href]="l.url"
                       target="_blank"
                       rel="noopener">
                      <span class="pdf-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <rect x="3" y="3" width="18" height="18" rx="4" fill="#d32f2f"/>
                          <text x="6" y="17" font-size="10" font-family="Arial, sans-serif" fill="#fff" font-weight="bold">PDF</text>
                        </svg>
                      </span>
                      <span [innerHTML]="l.label || l.url"></span>
                    </a>

                    <!-- Element tekstowy (opis w podlinku) -->
                    <div *ngIf="l.type==='opis' && l.text" class="grid-link sub-link text-item" style="position:relative;">
                      <!-- Etykieta gdy tekst jest zwiniÄ™ty -->
                      <div *ngIf="!l.show" class="text-collapsed-header" (click)="textVisibilityService.toggleTextVisibility(l); $event.stopPropagation();">
                        <div class="text-collapsed-left">
                          <span class="text-icon">ğŸ“</span>
                          <div class="text-toggle-label" [innerHTML]="l.label || 'CzuÅ‚e serce Å›w. Ludwika'"></div>
                        </div>
                        <span class="text-toggle-icon">â–¼</span>
                      </div>
                    </div>
                    <!-- overlay tekstu przeniesiony na koniec pliku -->
                  </ng-container>
                </ng-container>
                  </div>
                </div>
              </ng-container>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>

    <!-- STOPKA w kontenerku -->
    <div class="footer-section">
      <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
        <div style="font-size: 0.95em; color: #666;">Przydatne linki:  <a href="https://krukeu.sharepoint.com/sites/ITINTHQPL/SitePages/bibliotekaszablonow.aspx" target="_blank" rel="noopener">bibliotek szablonÃ³w</a></div>
        <div class="znak-wodny">
          Â© <span class="ozdobne">EO</span>
        </div>
      </div>
      <button class="close-button" (click)="closePage()">
        <span class="close-icon">Ã—</span>
        <span class="close-text">Zamknij stronÄ™</span>
      </button>
    </div>


<!-- FULLSCREEN IMAGE - overlay poza main -->
<div id="fullscreen-overlay" class="fullscreen-local" *ngIf="fullscreenImage" (click)="toggleFullscreen()">
  <img [src]="fullscreenImage" 
       class="fullscreen-local-image"
       loading="eager"
       decoding="async" />
</div>

<!-- FULLSCREEN TEXT - overlay poza main -->
<div *ngFor="let item of items" style="display:contents">
  <ng-container *ngFor="let group of item.links">
    <ng-container *ngFor="let l of group.links">
      <div class="text-fullscreen-overlay" *ngIf="l.type==='opis' && l.text && l.show" (click)="textVisibilityService.toggleTextVisibility(l)">
        <div class="text-fullscreen-content" (click)="textVisibilityService.toggleTextVisibility(l)">
          <button (click)="textVisibilityService.toggleTextVisibility(l)" class="close-text-btn" title="Zamknij tekst" style="position:absolute; top:12px; right:12px; background:#2563eb; border:none; font-size:1.3em; cursor:pointer; color:#fff; z-index:10; border-radius:50%; width:32px; height:32px; display:flex; align-items:center; justify-content:center; box-shadow:0 2px 8px rgba(59,130,246,0.18);">âœ–</button>
          <div class="sub-text" style="font-size:1.3em; font-weight:600; margin-bottom:1em; color:#2563eb;">{{ l.label }}</div>
          <div class="sub-text" [innerHTML]="textFormatService.processTextWithLinks(l.text)"></div>
        </div>
      </div>
    </ng-container>
  </ng-container>
</div>

<!-- FULLSCREEN PHOTO ALBUM - overlay poza main -->
<div *ngFor="let item of items" style="display:contents">
  <ng-container *ngFor="let group of item.links">
    <ng-container *ngFor="let l of group.links">
      <div *ngIf="l.name === 'PrzeglÄ…d kodu' && l.show && hasPhotoElements(l.links || []) && getPhotoCount(l.links || []) > 1" class="fullscreen-local" (click)="toggleOnlyNestedGroup(l, group.links || [])">
        <div (click)="$event.stopPropagation()">
          <photo-gallery [photos]="getPhotoElements(l.links || [])" [groupName]="l.name || ''"></photo-gallery>
        </div>
      </div>
    </ng-container>
  </ng-container>
</div>
